<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Share | é˜…åå³ç„š</title>
    
    <!-- å¼•å…¥ Vue 3 -->
    <script src="//unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥ Element Plus -->
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <link rel="stylesheet" href="//unpkg.com/element-plus/theme-chalk/dark/css-vars.css">
    <script src="//unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="//unpkg.com/@element-plus/icons-vue"></script>
    <!-- å¼•å…¥ Axios -->
    <script src="//unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        /* --- å…¨å±€æ ·å¼ & åŠ¨æ€èƒŒæ™¯ --- */
        body {
            margin: 0;
            background: radial-gradient(circle at top left, #1b2735 0%, #090a0f 100%);
            color: #ffffff;
            font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯å…‰æ–‘åŠ¨ç”» */
        body::before {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: linear-gradient(45deg, #409eff, #79bbff);
            filter: blur(120px);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            opacity: 0.2;
            z-index: -1;
            animation: float 10s infinite ease-in-out;
        }
        body::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #f56c6c, #fab6b6);
            filter: blur(100px);
            border-radius: 50%;
            bottom: -50px;
            right: -50px;
            opacity: 0.15;
            z-index: -1;
            animation: float 12s infinite ease-in-out reverse;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(30px, 20px); }
            100% { transform: translate(0, 0); }
        }

        /* --- æ¯›ç»ç’ƒå¡ç‰‡ --- */
        .glass-card {
            width: 100%;
            max-width: 650px;
            background: rgba(30, 30, 35, 0.6) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
            border-radius: 16px !important;
            transition: transform 0.3s ease;
        }

        /* æ ‡é¢˜æ ·å¼ */
        .header-area {
            text-align: center;
            margin-bottom: 30px;
        }
        .app-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(to right, #409eff, #a0cfff);
            -webkit-background-clip: text;
            color: transparent;
            margin: 10px 0;
            letter-spacing: 1px;
        }
        .app-subtitle {
            color: #888;
            font-size: 13px;
        }

        /* --- è¾“å…¥æ¡†ç¾åŒ– --- */
        .custom-textarea .el-textarea__inner {
            background-color: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: #eee !important;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace; /* ä»£ç é£æ ¼å­—ä½“ */
            font-size: 14px;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        .custom-textarea .el-textarea__inner:focus {
            border-color: #409eff !important;
            box-shadow: 0 0 15px rgba(64, 158, 255, 0.2) !important;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        .option-group {
            margin-bottom: 20px;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .option-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
            display: block;
        }

        /* ç»“æœé¡µæ ·å¼ */
        .result-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px dashed #67c23a;
            padding: 20px;
            border-radius: 8px;
            color: #67c23a;
            word-break: break-all;
            font-family: monospace;
            margin: 20px 0;
            position: relative;
        }

        /* åŠ¨ç”» */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app" style="width: 100%; padding: 20px; display: flex; justify-content: center;">
    
    <el-card class="glass-card">
        <!-- å¤´éƒ¨ -->
        <div class="header-area">
            <el-icon size="40" color="#409eff"><Lock /></el-icon>
            <h1 class="app-title">SECRET SHARE</h1>
            <div class="app-subtitle">ç«¯å¯¹ç«¯ä¸´æ—¶åŠ å¯† Â· é˜…åå³ç„š Â· éšç§æ— ç—•</div>
        </div>

        <!-- åœºæ™¯ 1: åŠ è½½ä¸­ -->
        <div v-if="loading" style="text-align: center; padding: 50px;">
            <el-icon class="is-loading" size="40" color="#409eff"><Loading /></el-icon>
            <p style="color: #888; margin-top: 15px;">æ­£åœ¨ä¸å®‰å…¨æœåŠ¡å™¨é€šä¿¡...</p>
        </div>

        <!-- åœºæ™¯ 2: åˆ›å»ºç§˜å¯† (é»˜è®¤é¦–é¡µ) -->
        <div v-else-if="viewMode === 'create'">
            <el-form label-position="top">
                <!-- è¾“å…¥åŒºåŸŸ -->
                <el-form-item>
                    <el-input 
                        v-model="form.content" 
                        type="textarea" 
                        :rows="8" 
                        class="custom-textarea"
                        placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„ç§˜å¯†ã€å¯†ç ã€API Key æˆ–ä»»ä½•æ•æ„Ÿä¿¡æ¯..."
                    ></el-input>
                </el-form-item>

                <el-row :gutter="20">
                    <!-- å·¦ä¾§ï¼šæœ€å¤§æŸ¥çœ‹æ¬¡æ•° -->
                    <el-col :xs="24" :sm="12">
                        <div class="option-group">
                            <span class="option-label"><el-icon><View /></el-icon> é”€æ¯æ¡ä»¶ (æ¬¡æ•°)</span>
                            
                            <!-- å•é€‰æŒ‰é’®ç»„ -->
                            <el-radio-group v-model="presets.views" size="small" style="width: 100%; margin-bottom: 10px;">
                                <el-radio-button label="1">1æ¬¡</el-radio-button>
                                <el-radio-button label="5">5æ¬¡</el-radio-button>
                                <el-radio-button label="10">10æ¬¡</el-radio-button>
                                <el-radio-button label="custom">è‡ªå®šä¹‰</el-radio-button>
                            </el-radio-group>

                            <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† (ä»…å½“é€‰ä¸­customæ—¶æ˜¾ç¤º) -->
                            <transition name="fade">
                                <el-input-number 
                                    v-if="presets.views === 'custom'"
                                    v-model="form.maxViews" 
                                    :min="1" 
                                    :max="999"
                                    style="width: 100%"
                                    placeholder="è¾“å…¥æ¬¡æ•°"
                                ></el-input-number>
                            </transition>
                        </div>
                    </el-col>

                    <!-- å³ä¾§ï¼šè¿‡æœŸæ—¶é—´ -->
                    <el-col :xs="24" :sm="12">
                        <div class="option-group">
                            <span class="option-label"><el-icon><Timer /></el-icon> æœ‰æ•ˆæœŸé™ (åˆ†é’Ÿ)</span>
                            
                            <el-radio-group v-model="presets.expiry" size="small" style="width: 100%; margin-bottom: 10px;">
                                <el-radio-button label="10">10åˆ†</el-radio-button>
                                <el-radio-button label="60">1å°æ—¶</el-radio-button>
                                <el-radio-button label="1440">1å¤©</el-radio-button>
                                <el-radio-button label="custom">è‡ªå®šä¹‰</el-radio-button>
                            </el-radio-group>

                            <transition name="fade">
                                <el-input-number 
                                    v-if="presets.expiry === 'custom'"
                                    v-model="form.expiryMinutes" 
                                    :min="1" 
                                    :max="10080"
                                    style="width: 100%"
                                    placeholder="è¾“å…¥åˆ†é’Ÿæ•°"
                                >
                                    <template #suffix>åˆ†é’Ÿ</template>
                                </el-input-number>
                            </transition>
                        </div>
                    </el-col>
                </el-row>

                <!-- æäº¤æŒ‰é’® -->
                <div style="margin-top: 10px;">
                    <el-button 
                        type="primary" 
                        size="large" 
                        style="width: 100%; height: 50px; font-size: 16px; background: linear-gradient(90deg, #409eff, #337ecc); border: none;" 
                        @click="createSecret" 
                        :loading="submitting"
                        round
                    >
                        <el-icon style="margin-right: 5px"><Key /></el-icon> ç”ŸæˆåŠ å¯†é“¾æ¥
                    </el-button>
                </div>
            </el-form>
        </div>

        <!-- åœºæ™¯ 3: é“¾æ¥å·²ç”Ÿæˆ -->
        <div v-else-if="viewMode === 'result'" style="text-align: center;">
            <el-result icon="success" title="åŠ å¯†é“¾æ¥å·²ç”Ÿæˆ" sub-title="åªæœ‰æ‹¥æœ‰æ­¤é“¾æ¥çš„äººæ‰èƒ½æŸ¥çœ‹ç§˜å¯†">
            </el-result>
            
            <div class="result-box" @click="copyLink" style="cursor: pointer;" title="ç‚¹å‡»å¤åˆ¶">
                {{ generatedUrl }}
            </div>

            <div style="display: flex; gap: 10px; justify-content: center;">
                <el-button type="success" @click="copyLink" round size="large">
                    <el-icon><CopyDocument /></el-icon> å¤åˆ¶é“¾æ¥
                </el-button>
                <el-button @click="resetForm" round size="large">å†å†™ä¸€ä¸ª</el-button>
            </div>
            
            <div style="margin-top: 25px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 12px; color: #888; text-align: left;">
                <p><el-icon><Warning /></el-icon> <strong>å®‰å…¨æç¤ºï¼š</strong></p>
                <ul style="margin: 5px 0; padding-left: 20px;">
                    <li>è¯¥é“¾æ¥å°†åœ¨ <strong>{{ form.maxViews }}</strong> æ¬¡è®¿é—®åå¤±æ•ˆã€‚</li>
                    <li>æˆ–è€…åœ¨ <strong>{{ form.expiryMinutes }}</strong> åˆ†é’Ÿåè‡ªåŠ¨é”€æ¯ã€‚</li>
                    <li>æœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•æ—¥å¿—ï¼Œæ•°æ®ä¸€æ—¦é”€æ¯æ— æ³•æ¢å¤ã€‚</li>
                </ul>
            </div>
        </div>

        <!-- åœºæ™¯ 4: æŸ¥çœ‹ç§˜å¯† -->
        <div v-else-if="viewMode === 'read'">
            <el-alert
                title="è¿™æ˜¯ä¸€æ¡é˜…åå³ç„šçš„æ¶ˆæ¯"
                type="warning"
                effect="dark"
                :closable="false"
                show-icon
                style="margin-bottom: 20px;"
            >
                <template #default>
                    å‰©ä½™æŸ¥çœ‹æ¬¡æ•°ï¼š<strong>{{ secretData.remainingViews }}</strong>ã€‚å¦‚æœä½ åˆ·æ–°é¡µé¢ï¼Œè¿™æ¡æ¶ˆæ¯å¯èƒ½ä¼šæ¶ˆå¤±ã€‚
                </template>
            </el-alert>

            <div style="position: relative;">
                <el-input 
                    :model-value="secretData.content" 
                    type="textarea" 
                    readonly 
                    :autosize="{ minRows: 6, maxRows: 15 }"
                    class="custom-textarea"
                ></el-input>
                <!-- ä¸€ä¸ªæ°´å°æ•ˆæœ -->
                <div v-if="secretData.isBurned" 
                     style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); 
                            border: 5px solid #f56c6c; color: #f56c6c; font-size: 40px; font-weight: bold; 
                            padding: 10px 30px; border-radius: 10px; opacity: 0.8; pointer-events: none;">
                    å·²é”€æ¯
                </div>
            </div>

            <div v-if="secretData.isBurned" style="margin-top: 20px; color: #f56c6c; text-align: center;">
                <el-icon><DeleteFilled /></el-icon> æ­¤é“¾æ¥å·²å¤±æ•ˆï¼Œæ•°æ®å·²ä»æœåŠ¡å™¨æ°¸ä¹…æ“¦é™¤ã€‚
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <el-button type="primary" plain round @click="resetForm">æˆ‘ä¹Ÿè¦å‘é€ç§˜å¯†</el-button>
            </div>
        </div>

        <!-- åœºæ™¯ 5: é”™è¯¯ -->
        <div v-else-if="viewMode === 'error'" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‘»</div>
            <h2 style="color: #909399; margin-bottom: 10px;">é“¾æ¥æ— æ•ˆ</h2>
            <p style="color: #666; margin-bottom: 30px;">
                è¯¥ç§˜å¯†å¯èƒ½å·²è¾¾åˆ°æŸ¥çœ‹ä¸Šé™ã€å·²è¿‡æœŸï¼Œæˆ–è€…ä»æœªå­˜åœ¨è¿‡ã€‚
            </p>
            <el-button type="primary" round @click="resetForm">åˆ›å»ºæ–°ç§˜å¯†</el-button>
        </div>

    </el-card>
</div>

<script>
    const { createApp, reactive, toRefs, onMounted, watch } = Vue;
    const { ElMessage } = ElementPlus;

    // --- é…ç½®åç«¯åœ°å€ ---
    const API_BASE_URL = 'http://localhost:8080/api';

    const app = createApp({
        setup() {
            const state = reactive({
                viewMode: 'create', // create, result, read, error
                loading: false,
                submitting: false,
                
                // é¢„è®¾å€¼çš„ä¸­é—´çŠ¶æ€
                presets: {
                    views: '1',     // é»˜è®¤é€‰ä¸­ "1æ¬¡"
                    expiry: '10'    // é»˜è®¤é€‰ä¸­ "10åˆ†é’Ÿ"
                },

                // å®é™…æäº¤ç»™åç«¯çš„è¡¨å•
                form: {
                    content: '',
                    maxViews: 1,
                    expiryMinutes: 10
                },
                
                generatedUrl: '',
                secretData: { content: '', remainingViews: 0, isBurned: false }
            });

            // --- é€»è¾‘ï¼šç›‘å¬é¢„è®¾å€¼çš„å˜åŒ– ---
            // å½“ç”¨æˆ·ç‚¹å‡»å•é€‰æŒ‰é’®æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°è¡¨å•æ•°æ®
            watch(() => state.presets.views, (newVal) => {
                if (newVal !== 'custom') {
                    state.form.maxViews = parseInt(newVal);
                }
            });

            watch(() => state.presets.expiry, (newVal) => {
                if (newVal !== 'custom') {
                    state.form.expiryMinutes = parseInt(newVal);
                }
            });

            // --- åˆå§‹åŒ– ---
            onMounted(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');
                if (id) {
                    fetchSecret(id);
                }
            });

            // --- API äº¤äº’ ---
            const createSecret = async () => {
                if (!state.form.content.trim()) {
                    ElMessage.warning('è¯·å…ˆè¾“å…¥ç§˜å¯†å†…å®¹');
                    return;
                }
                state.submitting = true;
                try {
                    const res = await axios.post(`${API_BASE_URL}/secrets`, state.form);
                    
                    // æ‹¼æ¥å½“å‰é¡µé¢URL + ID
                    const currentPath = window.location.href.split('?')[0];
                    state.generatedUrl = `${currentPath}?id=${res.data.id}`;
                    state.viewMode = 'result';
                } catch (error) {
                    console.error(error);
                    ElMessage.error('æœåŠ¡è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨');
                } finally {
                    state.submitting = false;
                }
            };

            const fetchSecret = async (id) => {
                state.viewMode = 'read';
                state.loading = true;
                try {
                    const res = await axios.get(`${API_BASE_URL}/secrets/${id}`);
                    state.secretData = res.data;
                } catch (error) {
                    console.error(error);
                    state.viewMode = 'error';
                } finally {
                    state.loading = false;
                }
            };

            const copyLink = () => {
                navigator.clipboard.writeText(state.generatedUrl).then(() => {
                    ElMessage.success({
                        message: 'é“¾æ¥å·²å¤åˆ¶ï¼Œå¿«å»åˆ†äº«å§ï¼',
                        type: 'success',
                    });
                });
            };

            const resetForm = () => {
                window.history.pushState({}, document.title, window.location.pathname);
                state.form.content = '';
                // é‡ç½®å›é»˜è®¤çŠ¶æ€
                state.presets.views = '1';
                state.form.maxViews = 1;
                state.presets.expiry = '10';
                state.form.expiryMinutes = 10;
                
                state.viewMode = 'create';
            };

            return {
                ...toRefs(state),
                createSecret,
                copyLink,
                resetForm
            };
        }
    });

    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
        app.component(key, component)
    }

    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>